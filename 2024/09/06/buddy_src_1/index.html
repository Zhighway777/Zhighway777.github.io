<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Buddy Compiler 源码解读(1) | Zeng::blog</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="A brief introduction to the overall architectyre of buddy Compiler and an analysis some of the buddy, In This part, we delve into the Lower Pass to explore how the dialect is Lowered.">
    <meta name="generator" content="Hugo 0.92.2" />
    
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    
      <meta name="author" content = "Zeng">
    
    
    <link rel="stylesheet" href="/css/style.css">
    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



  
    <link rel="stylesheet" href="/css/syntax.css">
  

    

    
      

    

		
    

    
      <link rel="canonical" href="https://zhighway777.github.io/2024/09/06/buddy_src_1/">
    

    <meta property="og:title" content="Buddy Compiler 源码解读(1)" />
<meta property="og:description" content="A brief introduction to the overall architectyre of buddy Compiler and an analysis some of the buddy, In This part, we delve into the Lower Pass to explore how the dialect is Lowered." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhighway777.github.io/2024/09/06/buddy_src_1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-09-06T23:23:03+08:00" />
<meta property="article:modified_time" content="2024-09-06T23:23:03+08:00" />

<meta itemprop="name" content="Buddy Compiler 源码解读(1)">
<meta itemprop="description" content="A brief introduction to the overall architectyre of buddy Compiler and an analysis some of the buddy, In This part, we delve into the Lower Pass to explore how the dialect is Lowered."><meta itemprop="datePublished" content="2024-09-06T23:23:03+08:00" />
<meta itemprop="dateModified" content="2024-09-06T23:23:03+08:00" />
<meta itemprop="wordCount" content="2947">
<meta itemprop="keywords" content="MLIR,AI Compiler," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Buddy Compiler 源码解读(1)"/>
<meta name="twitter:description" content="A brief introduction to the overall architectyre of buddy Compiler and an analysis some of the buddy, In This part, we delve into the Lower Pass to explore how the dialect is Lowered."/>

	

<link rel="stylesheet" href="/css/style.css">

  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Zeng::blog
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/posts/" title="Blog page">
              Blog
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/about/" title="About me page">
              About me
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/album/" title="Album page">
              Album
            </a>
          </li>
          
        </ul>
      
      
<div class="ananke-socials">
  
    
    <a href="https://github.com/Zhighway777" target="_blank" rel="noopener" class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
</div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside>
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f1 athelas mt3 mb1">Buddy Compiler 源码解读(1)</h1>
      
      
      <p class="tracked">
        By <strong>Zeng</strong>
      </p>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2024-09-06T23:23:03+08:00">September 6, 2024</time>
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h2 id="examples-解读">Examples 解读</h2>
<p>首先解读关于：</p>
<p>BudDialect, GemminiDialect, MLIRMemRef, MLIRTensor, RVVDialect, ToyDSL</p>
<h3 id="buddialect"><code>BudDialect</code></h3>
<p>首先打开makefile 看能执行那些make操作。</p>
<p><code>bud-constant.mlir</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-llvm" data-lang="llvm"><span class="k">module</span> <span class="p">{</span>
<span class="err">//</span> <span class="nl">CHECK:</span> <span class="err">%</span><span class="p">{{.*}}</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="k">constant</span> <span class="m">0</span> <span class="err">:</span> <span class="k">i32</span>
<span class="nv">%i0</span> <span class="p">=</span> <span class="nl">bud.test_constant :</span> <span class="k">i32</span>
<span class="p">}</span>
</code></pre></div><p>执行make bud-constant-lower后得到log.mlir,</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-llvm" data-lang="llvm"><span class="k">module</span> <span class="p">{</span>
<span class="nv">%c0_i32</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="k">constant</span> <span class="m">0</span> <span class="err">:</span> <span class="k">i32</span>
<span class="p">}</span>
</code></pre></div><p>比较二者区别 发现数据名称变得更加规范， dialect从bud变为了arith</p>
<p>我们看看这里是如何发生的？ <strong>？未能解决</strong></p>
<p>阅读makefile文件发现，这里其实是运行了buddy-opt ./bud-constant.mlir &ndash;lower-bud -o ./log.mlir</p>
<p>官方文档的解释里 被Lower的 Target格式为：<!-- raw HTML omitted -->-<!-- raw HTML omitted --></p>
<p><code>bud-array-attr.mlir</code></p>
<p>Dialect：bud</p>
<p>operation name：array</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-llvm" data-lang="llvm"><span class="k">module</span> <span class="p">{</span>
<span class="err">//声明一个名为</span><span class="vg">@gv的全局memory</span> <span class="err">refere</span><span class="k">ne</span>
  <span class="err">memref</span><span class="p">.</span><span class="k">global</span> <span class="s">&#34;private&#34;</span> <span class="vg">@gv</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">4</span><span class="err">x</span><span class="m">4</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span> <span class="p">=</span> <span class="err">dense</span><span class="p">&lt;[[</span><span class="m">0</span><span class="p">.</span> <span class="p">,</span> <span class="m">1</span><span class="p">.</span> <span class="p">,</span> <span class="m">2</span><span class="p">.</span> <span class="p">,</span> <span class="m">3</span><span class="p">.</span> <span class="p">],</span>
                                                         <span class="p">[</span><span class="m">10</span><span class="p">.,</span> <span class="m">11</span><span class="p">.,</span> <span class="m">12</span><span class="p">.,</span> <span class="m">13</span><span class="p">.],</span>
                                                         <span class="p">[</span><span class="m">20</span><span class="p">.,</span> <span class="m">21</span><span class="p">.,</span> <span class="m">22</span><span class="p">.,</span> <span class="m">23</span><span class="p">.],</span>
                                                         <span class="p">[</span><span class="m">30</span><span class="p">.,</span> <span class="m">31</span><span class="p">.,</span> <span class="m">32</span><span class="p">.,</span> <span class="m">33</span><span class="p">.]]&gt;</span>
  <span class="err">//获取全局mem</span> <span class="err">ref</span> <span class="err">并存放在本地SSA变量</span><span class="nv">%mem中</span><span class="err">，同时规定其类型和tensor一致</span>
  <span class="nv">%mem</span> <span class="p">=</span> <span class="err">memref</span><span class="p">.</span><span class="err">get_</span><span class="k">global</span> <span class="vg">@gv</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">4</span><span class="err">x</span><span class="m">4</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
  <span class="err">//调用bud</span><span class="p">.</span><span class="err">test_arrat_attr</span> <span class="err">操作，输入是</span><span class="nv">%mem</span><span class="p">,</span> <span class="err">属性</span> <span class="err">attribute是</span> <span class="err">coordinate</span><span class="p">[</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">]</span>
  <span class="err">//期望的输入type为</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">4</span><span class="err">x</span><span class="m">4</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span><span class="err">，</span> <span class="err">产生一个f</span><span class="m">32</span><span class="err">的标量结果</span>
  <span class="nv">%res</span> <span class="p">=</span> <span class="err">bud</span><span class="p">.</span><span class="err">test_array_attr</span> <span class="nv">%mem</span> <span class="p">{</span><span class="err">coordinate</span> <span class="p">=</span> <span class="p">[</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">]}</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">4</span><span class="err">x</span><span class="m">4</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;,</span> <span class="err">f</span><span class="m">32</span>
<span class="p">}</span>
</code></pre></div><p>Lower: bud → memref  并且多了两个arith.constant 常量0, 1代替原始的coordinate</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-llvm" data-lang="llvm"><span class="k">module</span> <span class="p">{</span>
  <span class="err">memref</span><span class="p">.</span><span class="k">global</span> <span class="s">&#34;private&#34;</span> <span class="vg">@gv</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">4</span><span class="err">x</span><span class="m">4</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span> <span class="p">=</span> <span class="err">dense</span><span class="p">&lt;[[</span><span class="m">0.000000e+00</span><span class="p">,</span> <span class="m">1.000000e+00</span><span class="p">,</span> <span class="m">2.000000e+00</span><span class="p">,</span> <span class="m">3.000000e+00</span><span class="p">],</span> <span class="p">[</span><span class="m">1.000000e+01</span><span class="p">,</span> <span class="m">1.100000e+01</span><span class="p">,</span> <span class="m">1.200000e+01</span><span class="p">,</span> <span class="m">1.300000e+01</span><span class="p">],</span> <span class="p">[</span><span class="m">2.000000e+01</span><span class="p">,</span> <span class="m">2.100000e+01</span><span class="p">,</span> <span class="m">2.200000e+01</span><span class="p">,</span> <span class="m">2.300000e+01</span><span class="p">],</span> <span class="p">[</span><span class="m">3.000000e+01</span><span class="p">,</span> <span class="m">3.100000e+01</span><span class="p">,</span> <span class="m">3.200000e+01</span><span class="p">,</span> <span class="m">3.300000e+01</span><span class="p">]]&gt;</span>
  <span class="n">%0</span> <span class="p">=</span> <span class="err">memref</span><span class="p">.</span><span class="err">get_</span><span class="k">global</span> <span class="vg">@gv</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">4</span><span class="err">x</span><span class="m">4</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
  <span class="nv">%c0</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="k">constant</span> <span class="m">0</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span>
  <span class="nv">%c1</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="k">constant</span> <span class="m">1</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span>
  <span class="n">%1</span> <span class="p">=</span> <span class="err">memref</span><span class="p">.</span><span class="k">load</span> <span class="n">%0</span><span class="p">[</span><span class="nv">%c0</span><span class="p">,</span> <span class="nv">%c1</span><span class="p">]</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">4</span><span class="err">x</span><span class="m">4</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
<span class="p">}</span>
</code></pre></div><p><code>bud-print.mlir</code></p>
<p>Dialect：bud</p>
<p>Op name：print</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-llvm" data-lang="llvm"><span class="p">**</span><span class="k">module</span> <span class="p">{</span>
  <span class="nv">%i0</span> <span class="p">=</span> <span class="nl">bud.test_print :</span> <span class="k">i32</span>
<span class="p">}**</span>
</code></pre></div><p>Lower：首先生成一个arith.constant 接着vector输出，<strong>和广播输出？？为什么这样做</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-llvm" data-lang="llvm"><span class="k">module</span> <span class="p">{</span>
  <span class="nv">%c0_i32</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="k">constant</span> <span class="m">0</span> <span class="err">:</span> <span class="k">i32</span>
  <span class="err">vect</span><span class="k">or</span><span class="p">.</span><span class="err">print</span> <span class="nv">%c0_i32</span> <span class="err">:</span> <span class="k">i32</span>
  <span class="n">%0</span> <span class="p">=</span> <span class="err">vect</span><span class="k">or</span><span class="p">.</span><span class="err">broadcast</span> <span class="nv">%c0_i32</span> <span class="err">:</span> <span class="k">i32</span> <span class="k">to</span> <span class="err">vect</span><span class="k">or</span><span class="p">&lt;</span><span class="m">4</span><span class="err">x</span><span class="k">i32</span><span class="p">&gt;</span>
  <span class="err">vect</span><span class="k">or</span><span class="p">.</span><span class="err">print</span> <span class="n">%0</span> <span class="err">:</span> <span class="err">vect</span><span class="k">or</span><span class="p">&lt;</span><span class="m">4</span><span class="err">x</span><span class="k">i32</span><span class="p">&gt;</span>
<span class="p">}</span>
</code></pre></div><p><code>bud-inline-interface.mlir</code></p>
<p>Opname 内联接口</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-llvm" data-lang="llvm"><span class="err">memref</span><span class="p">.</span><span class="k">global</span> <span class="s">&#34;private&#34;</span> <span class="vg">@gv</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">4</span><span class="err">x</span><span class="m">4</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span> <span class="p">=</span> <span class="err">dense</span><span class="p">&lt;[[</span><span class="m">0</span><span class="p">.</span> <span class="p">,</span> <span class="m">1</span><span class="p">.</span> <span class="p">,</span> <span class="m">2</span><span class="p">.</span> <span class="p">,</span> <span class="m">3</span><span class="p">.</span> <span class="p">],</span>
                                                       <span class="p">[</span><span class="m">10</span><span class="p">.,</span> <span class="m">11</span><span class="p">.,</span> <span class="m">12</span><span class="p">.,</span> <span class="m">13</span><span class="p">.],</span>
                                                       <span class="p">[</span><span class="m">20</span><span class="p">.,</span> <span class="m">21</span><span class="p">.,</span> <span class="m">22</span><span class="p">.,</span> <span class="m">23</span><span class="p">.],</span>
                                                       <span class="p">[</span><span class="m">30</span><span class="p">.,</span> <span class="m">31</span><span class="p">.,</span> <span class="m">32</span><span class="p">.,</span> <span class="m">33</span><span class="p">.]]&gt;</span>

<span class="err">//定义一个操作，名为</span> <span class="vg">@example</span><span class="p">()</span><span class="err">接受一个参数，且类型为memref</span><span class="p">&lt;</span><span class="m">4</span><span class="err">x</span><span class="m">4</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span><span class="err">，</span>
<span class="err">//并返回一个f</span><span class="m">32</span><span class="err">的标量结果</span>
<span class="err">fun</span><span class="k">c</span><span class="p">.</span><span class="err">fun</span><span class="k">c</span> <span class="k">private</span> <span class="vg">@example</span><span class="p">(</span><span class="nv">%arg0</span><span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">4</span><span class="err">x</span><span class="m">4</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;)</span> <span class="err">-</span><span class="p">&gt;</span> <span class="p">(</span><span class="err">f</span><span class="m">32</span><span class="p">)</span> <span class="p">{</span>
  <span class="nv">%res</span> <span class="p">=</span> <span class="err">bud</span><span class="p">.</span><span class="err">test_array_attr</span> <span class="nv">%arg0</span> <span class="p">{</span><span class="err">coordinate</span> <span class="p">=</span> <span class="p">[</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">]}</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">4</span><span class="err">x</span><span class="m">4</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;,</span> <span class="err">f</span><span class="m">32</span>
  <span class="err">return</span> <span class="nv">%res</span> <span class="err">:</span> <span class="err">f</span><span class="m">32</span>
<span class="p">}</span>

<span class="err">fun</span><span class="k">c</span><span class="p">.</span><span class="err">fun</span><span class="k">c</span> <span class="vg">@main</span><span class="p">()</span> <span class="p">{</span>
  <span class="nv">%mem</span> <span class="p">=</span> <span class="err">memref</span><span class="p">.</span><span class="err">get_</span><span class="k">global</span> <span class="vg">@gv</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">4</span><span class="err">x</span><span class="m">4</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
  <span class="err">//</span> <span class="nl">CHECK:</span> <span class="err">%</span><span class="p">{{.*}}</span> <span class="p">=</span> <span class="err">bud</span><span class="p">.</span><span class="err">test_array_attr</span> <span class="p">{{.*}}</span>
  <span class="n">%1</span> <span class="p">=</span> <span class="err">fun</span><span class="k">c</span><span class="p">.</span><span class="k">call</span> <span class="vg">@example</span><span class="p">(</span><span class="nv">%mem</span><span class="p">)</span> <span class="err">:</span> <span class="p">(</span><span class="err">memref</span><span class="p">&lt;</span><span class="m">4</span><span class="err">x</span><span class="m">4</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;)</span> <span class="err">-</span><span class="p">&gt;</span> <span class="p">(</span><span class="err">f</span><span class="m">32</span><span class="p">)</span>
  <span class="err">vect</span><span class="k">or</span><span class="p">.</span><span class="err">print</span> <span class="n">%1</span> <span class="err">:</span> <span class="err">f</span><span class="m">32</span> 
  <span class="err">return</span>
<span class="p">}</span>
</code></pre></div><p>Lower：这里省去了操作定义的部分，直接将func.call @example 进行了替换，对操作进行了优化</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-llvm" data-lang="llvm"><span class="k">module</span> <span class="p">{</span>
  <span class="err">memref</span><span class="p">.</span><span class="k">global</span> <span class="s">&#34;private&#34;</span> <span class="vg">@gv</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">4</span><span class="err">x</span><span class="m">4</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span> <span class="p">=</span> <span class="err">dense</span><span class="p">&lt;[[</span><span class="m">0.000000e+00</span><span class="p">,</span> <span class="m">1.000000e+00</span><span class="p">,</span> <span class="m">2.000000e+00</span><span class="p">,</span> <span class="m">3.000000e+00</span><span class="p">],</span> <span class="p">[</span><span class="m">1.000000e+01</span><span class="p">,</span> <span class="m">1.100000e+01</span><span class="p">,</span> <span class="m">1.200000e+01</span><span class="p">,</span> <span class="m">1.300000e+01</span><span class="p">],</span> <span class="p">[</span><span class="m">2.000000e+01</span><span class="p">,</span> <span class="m">2.100000e+01</span><span class="p">,</span> <span class="m">2.200000e+01</span><span class="p">,</span> <span class="m">2.300000e+01</span><span class="p">],</span> <span class="p">[</span><span class="m">3.000000e+01</span><span class="p">,</span> <span class="m">3.100000e+01</span><span class="p">,</span> <span class="m">3.200000e+01</span><span class="p">,</span> <span class="m">3.300000e+01</span><span class="p">]]&gt;</span>
  <span class="err">fun</span><span class="k">c</span><span class="p">.</span><span class="err">fun</span><span class="k">c</span> <span class="vg">@main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">%0</span> <span class="p">=</span> <span class="err">memref</span><span class="p">.</span><span class="err">get_</span><span class="k">global</span> <span class="vg">@gv</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">4</span><span class="err">x</span><span class="m">4</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
    <span class="n">%1</span> <span class="p">=</span> <span class="err">bud</span><span class="p">.</span><span class="err">test_array_attr</span> <span class="n">%0</span> <span class="p">{</span><span class="err">coordinate</span> <span class="p">=</span> <span class="p">[</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">]}</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">4</span><span class="err">x</span><span class="m">4</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;,</span> <span class="err">f</span><span class="m">32</span>
    <span class="err">vect</span><span class="k">or</span><span class="p">.</span><span class="err">print</span> <span class="n">%1</span> <span class="err">:</span> <span class="err">f</span><span class="m">32</span>
    <span class="err">return</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="ir级别的解读">IR级别的解读</h3>
<h3 id="mlirmemref"><code>MLIRMemRef</code></h3>
<p><code>memref-dim.mlir</code></p>
<p>关于memref Dialect,可以查看MLIR官方介绍</p>
<p><code>memref.alloc</code> (memref::AllocOp) <a href="https://mlir.llvm.org/docs/Dialects/MemRef/#memrefalloc-memrefallocop">¶</a>   分配memref类型的空间</p>
<p><code>memref.dim</code> (memref::DimOp) <a href="https://mlir.llvm.org/docs/Dialects/MemRef/#memrefdim-memrefdimop">¶</a>   返回矩阵的某个维度</p>
<p><code>memref.cast</code> (memref::CastOp) <a href="https://mlir.llvm.org/docs/Dialects/MemRef/#memrefcast-memrefcastop">¶</a>  1. 目的元素类型位置，则是为了擦除静态shape信息，使用动态信息表示2. 源元素未知，则是用来进行“断言”，查看输入结果和预期是否相符 同时支持跨步访存</p>
<p><code>func.func @example(){…}</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-llvm" data-lang="llvm"><span class="err">fun</span><span class="k">c</span><span class="p">.</span><span class="err">fun</span><span class="k">c</span> <span class="vg">@main</span><span class="p">()</span> <span class="p">{</span>
	<span class="err">//</span><span class="nv">%c0</span> <span class="k">define</span> <span class="err">the</span> <span class="k">constant</span> <span class="err">value</span> <span class="err">c</span><span class="m">0</span>
	<span class="p">[</span><span class="err">//arith</span><span class="p">.</span><span class="k">constant</span><span class="p">](</span><span class="nl">https:</span><span class="err">//arith</span><span class="p">.</span><span class="k">constant</span><span class="err">/</span><span class="p">)</span> <span class="err">is</span> <span class="err">an</span> <span class="err">operation</span> <span class="err">in</span> <span class="err">arith</span> <span class="err">Dialect</span>
	<span class="nv">%c0</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="k">constant</span> <span class="m">0</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span>
	<span class="nv">%c1</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="k">constant</span> <span class="m">1</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span>
	<span class="p">[</span><span class="err">//memref</span><span class="p">.</span><span class="err">allo</span><span class="k">c</span><span class="p">](</span><span class="nl">https:</span><span class="err">//memref</span><span class="p">.</span><span class="err">allo</span><span class="k">c</span><span class="err">/</span><span class="p">)</span> <span class="err">memory</span> <span class="err">allocatio</span> <span class="err">operation</span>
	<span class="err">//</span>
	<span class="nv">%mem0</span> <span class="p">=</span> <span class="err">memref</span><span class="p">.</span><span class="err">allo</span><span class="k">c</span><span class="p">()</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">2</span><span class="err">x</span><span class="m">3</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
	<span class="nv">%mem1</span> <span class="p">=</span> <span class="err">memref</span><span class="p">.</span><span class="err">cast</span> <span class="nv">%mem0</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">2</span><span class="err">x</span><span class="m">3</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span> <span class="k">to</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;</span>
	<span class="nv">%dim0</span> <span class="p">=</span> <span class="err">memref</span><span class="p">.</span><span class="err">dim</span> <span class="nv">%mem0</span><span class="p">,</span> <span class="nv">%c0</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">2</span><span class="err">x</span><span class="m">3</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
	<span class="nv">%dim1</span> <span class="p">=</span> <span class="err">memref</span><span class="p">.</span><span class="err">dim</span> <span class="nv">%mem0</span><span class="p">,</span> <span class="nv">%c1</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">2</span><span class="err">x</span><span class="m">3</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
	<span class="nv">%dim2</span> <span class="p">=</span> <span class="err">memref</span><span class="p">.</span><span class="err">dim</span> <span class="nv">%mem1</span><span class="p">,</span> <span class="nv">%c0</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;</span>
	<span class="nv">%dim3</span> <span class="p">=</span> <span class="err">memref</span><span class="p">.</span><span class="err">dim</span> <span class="nv">%mem1</span><span class="p">,</span> <span class="nv">%c1</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;</span>
	<span class="err">vect</span><span class="k">or</span><span class="p">.</span><span class="err">print</span> <span class="nv">%dim0</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span>
	<span class="err">vect</span><span class="k">or</span><span class="p">.</span><span class="err">print</span> <span class="nv">%dim1</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span>
	<span class="err">vect</span><span class="k">or</span><span class="p">.</span><span class="err">print</span> <span class="nv">%dim2</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span>
	<span class="err">vect</span><span class="k">or</span><span class="p">.</span><span class="err">print</span> <span class="nv">%dim3</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span>
	<span class="err">memref</span><span class="p">.</span><span class="err">deallo</span><span class="k">c</span> <span class="nv">%mem0</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="m">2</span><span class="err">x</span><span class="m">3</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
<span class="err">return</span>
<span class="p">}</span>
</code></pre></div><p>Lower：memref, vector, arith → llvm</p>
<p>与BudDialect不同 这里又增添了许多其他选项</p>
<p><code>${MLIR_OPT} ./memref-dim.mlir \ -finalize-memref-to-llvm -convert-arith-to-llvm -convert-vector-to-llvm \ -convert-func-to-llvm -reconcile-unrealized-casts \ -o ./log.mlir</code></p>
<p>新增的指令可以在官方查阅</p>
<p><code>llvm.func</code> (LLVM::LLVMFuncOp) <a href="https://mlir.llvm.org/docs/Dialects/LLVM/#llvmfunc-llvmllvmfuncop">¶</a>  这是MLIR中的LLVM Dialect, 其操作与LLVM IR兼容，但是内部使用MLIR的语法来表示。其作用是方便MLIR与LLVM IR 之间的交互和转换，允许MLIR无缝Lowering到LLVM IR中。</p>
<p><code>*llvm.mlir.constant</code> (LLVM::ConstantOp) <a href="https://mlir.llvm.org/docs/Dialects/LLVM/#llvmmlirconstant-llvmconstantop">¶</a>*   定义一个llvm类型的常量</p>
<p><code>llvm.mlir.zero</code> (LLVM::ZeroOp) <a href="https://mlir.llvm.org/docs/Dialects/LLVM/#llvmmlirzero-llvmzeroop">¶</a>  创建一个0初始值，没有任何操作数或者属性</p>
<p><code>llvm.getelementptr</code> (LLVM::GEPOp) <a href="https://mlir.llvm.org/docs/Dialects/LLVM/#llvmgetelementptr-llvmgepop">¶</a> 是LLVM IR取指针值元素的镜像操作</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-llvm" data-lang="llvm"><span class="k">module</span> <span class="p">{</span>
  <span class="err">llvm</span><span class="p">.</span><span class="err">fun</span><span class="k">c</span> <span class="vg">@printNewline</span><span class="p">()</span>
  <span class="err">llvm</span><span class="p">.</span><span class="err">fun</span><span class="k">c</span> <span class="vg">@printU64</span><span class="p">(</span><span class="k">i64</span><span class="p">)</span>
  <span class="err">llvm</span><span class="p">.</span><span class="err">fun</span><span class="k">c</span> <span class="vg">@free</span><span class="p">(</span><span class="nv">!llvm.ptr</span><span class="p">)</span>
  <span class="err">llvm</span><span class="p">.</span><span class="err">fun</span><span class="k">c</span> <span class="vg">@malloc</span><span class="p">(</span><span class="k">i64</span><span class="p">)</span> <span class="err">-</span><span class="p">&gt;</span> <span class="nv">!llvm.ptr</span>
  <span class="err">llvm</span><span class="p">.</span><span class="err">fun</span><span class="k">c</span> <span class="vg">@main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">%0</span> <span class="p">=</span> <span class="err">llvm</span><span class="p">.</span><span class="err">mlir</span><span class="p">.</span><span class="k">constant</span><span class="p">(</span><span class="m">2</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span><span class="p">)</span> <span class="err">:</span> <span class="k">i64</span>
    <span class="n">%1</span> <span class="p">=</span> <span class="err">llvm</span><span class="p">.</span><span class="err">mlir</span><span class="p">.</span><span class="k">constant</span><span class="p">(</span><span class="m">3</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span><span class="p">)</span> <span class="err">:</span> <span class="k">i64</span>
    <span class="n">%2</span> <span class="p">=</span> <span class="nl">llvm.mlir.zero :</span> <span class="nv">!llvm.ptr</span>
    <span class="n">%3</span> <span class="p">=</span> <span class="err">llvm</span><span class="p">.</span><span class="k">getelementptr</span> <span class="n">%2</span><span class="p">[</span><span class="m">6</span><span class="p">]</span> <span class="err">:</span> <span class="p">(</span><span class="nv">!llvm.ptr</span><span class="p">)</span> <span class="err">-</span><span class="p">&gt;</span> <span class="nv">!llvm.ptr</span><span class="p">,</span> <span class="err">f</span><span class="m">32</span>
    <span class="n">%4</span> <span class="p">=</span> <span class="err">llvm</span><span class="p">.</span><span class="k">ptrtoint</span> <span class="n">%3</span> <span class="err">:</span> <span class="nv">!llvm.ptr</span> <span class="k">to</span> <span class="k">i64</span>
    <span class="n">%5</span> <span class="p">=</span> <span class="err">llvm</span><span class="p">.</span><span class="k">call</span> <span class="vg">@malloc</span><span class="p">(</span><span class="n">%4</span><span class="p">)</span> <span class="err">:</span> <span class="p">(</span><span class="k">i64</span><span class="p">)</span> <span class="err">-</span><span class="p">&gt;</span> <span class="nv">!llvm.ptr</span>
    <span class="err">llvm</span><span class="p">.</span><span class="k">call</span> <span class="vg">@printU64</span><span class="p">(</span><span class="n">%0</span><span class="p">)</span> <span class="err">:</span> <span class="p">(</span><span class="k">i64</span><span class="p">)</span> <span class="err">-</span><span class="p">&gt;</span> <span class="p">()</span>
    <span class="err">llvm</span><span class="p">.</span><span class="k">call</span> <span class="vg">@printNewline</span><span class="p">()</span> <span class="err">:</span> <span class="p">()</span> <span class="err">-</span><span class="p">&gt;</span> <span class="p">()</span>
    <span class="err">llvm</span><span class="p">.</span><span class="k">call</span> <span class="vg">@printU64</span><span class="p">(</span><span class="n">%1</span><span class="p">)</span> <span class="err">:</span> <span class="p">(</span><span class="k">i64</span><span class="p">)</span> <span class="err">-</span><span class="p">&gt;</span> <span class="p">()</span>
    <span class="err">llvm</span><span class="p">.</span><span class="k">call</span> <span class="vg">@printNewline</span><span class="p">()</span> <span class="err">:</span> <span class="p">()</span> <span class="err">-</span><span class="p">&gt;</span> <span class="p">()</span>
    <span class="err">llvm</span><span class="p">.</span><span class="k">call</span> <span class="vg">@printU64</span><span class="p">(</span><span class="n">%0</span><span class="p">)</span> <span class="err">:</span> <span class="p">(</span><span class="k">i64</span><span class="p">)</span> <span class="err">-</span><span class="p">&gt;</span> <span class="p">()</span>
    <span class="err">llvm</span><span class="p">.</span><span class="k">call</span> <span class="vg">@printNewline</span><span class="p">()</span> <span class="err">:</span> <span class="p">()</span> <span class="err">-</span><span class="p">&gt;</span> <span class="p">()</span>
    <span class="err">llvm</span><span class="p">.</span><span class="k">call</span> <span class="vg">@printU64</span><span class="p">(</span><span class="n">%1</span><span class="p">)</span> <span class="err">:</span> <span class="p">(</span><span class="k">i64</span><span class="p">)</span> <span class="err">-</span><span class="p">&gt;</span> <span class="p">()</span>
    <span class="err">llvm</span><span class="p">.</span><span class="k">call</span> <span class="vg">@printNewline</span><span class="p">()</span> <span class="err">:</span> <span class="p">()</span> <span class="err">-</span><span class="p">&gt;</span> <span class="p">()</span>
    <span class="err">llvm</span><span class="p">.</span><span class="k">call</span> <span class="vg">@free</span><span class="p">(</span><span class="n">%5</span><span class="p">)</span> <span class="err">:</span> <span class="p">(</span><span class="nv">!llvm.ptr</span><span class="p">)</span> <span class="err">-</span><span class="p">&gt;</span> <span class="p">()</span>
    <span class="err">llvm</span><span class="p">.</span><span class="err">return</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>进行 make meref-dim-translate, 实际上的行为：</p>
<p><code>${MLIR_OPT} ./memref-dim.mlir \ -finalize-memref-to-llvm -convert-arith-to-llvm -convert-vector-to-llvm \ -convert-func-to-llvm -reconcile-unrealized-casts | \ ${MLIR_TRANSLATE} --mlir-to-llvmir -o log.ll</code></p>
<p>Translate：将LLVM Dialect translate为真正的了LLVM IR</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-llvm" data-lang="llvm"><span class="c">; ModuleID = &#39;LLVMDialectModule&#39;
</span><span class="c"></span><span class="k">source_filename</span> <span class="p">=</span> <span class="s">&#34;LLVMDialectModule&#34;</span>
<span class="k">declare</span> <span class="err">ptr</span> <span class="vg">@malloc</span><span class="p">(</span><span class="k">i64</span><span class="p">)</span>
<span class="k">declare</span> <span class="kt">void</span> <span class="vg">@free</span><span class="p">(</span><span class="err">ptr</span><span class="p">)</span>
<span class="k">declare</span> <span class="kt">void</span> <span class="vg">@printNewline</span><span class="p">()</span>
<span class="k">declare</span> <span class="kt">void</span> <span class="vg">@printU64</span><span class="p">(</span><span class="k">i64</span><span class="p">)</span>
<span class="k">define</span> <span class="kt">void</span> <span class="vg">@main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">%1</span> <span class="p">=</span> <span class="k">call</span> <span class="err">ptr</span> <span class="vg">@malloc</span><span class="p">(</span><span class="k">i64</span> <span class="k">ptrtoint</span> <span class="p">(</span><span class="err">ptr</span> <span class="k">getelementptr</span> <span class="p">(</span><span class="kt">float</span><span class="p">,</span> <span class="err">ptr</span> <span class="k">null</span><span class="p">,</span> <span class="k">i32</span> <span class="m">6</span><span class="p">)</span> <span class="k">to</span> <span class="k">i64</span><span class="p">))</span>
  <span class="k">call</span> <span class="kt">void</span> <span class="vg">@printU64</span><span class="p">(</span><span class="k">i64</span> <span class="m">2</span><span class="p">)</span>
  <span class="k">call</span> <span class="kt">void</span> <span class="vg">@printNewline</span><span class="p">()</span>
  <span class="k">call</span> <span class="kt">void</span> <span class="vg">@printU64</span><span class="p">(</span><span class="k">i64</span> <span class="m">3</span><span class="p">)</span>
  <span class="k">call</span> <span class="kt">void</span> <span class="vg">@printNewline</span><span class="p">()</span>
  <span class="k">call</span> <span class="kt">void</span> <span class="vg">@printU64</span><span class="p">(</span><span class="k">i64</span> <span class="m">2</span><span class="p">)</span>
  <span class="k">call</span> <span class="kt">void</span> <span class="vg">@printNewline</span><span class="p">()</span>
  <span class="k">call</span> <span class="kt">void</span> <span class="vg">@printU64</span><span class="p">(</span><span class="k">i64</span> <span class="m">3</span><span class="p">)</span>
  <span class="k">call</span> <span class="kt">void</span> <span class="vg">@printNewline</span><span class="p">()</span>
  <span class="k">call</span> <span class="kt">void</span> <span class="vg">@free</span><span class="p">(</span><span class="err">ptr</span> <span class="n">%1</span><span class="p">)</span>
  <span class="k">ret</span> <span class="kt">void</span>
<span class="p">}</span>
<span class="nv">!llvm.module.flags</span> <span class="p">=</span> <span class="p">!{</span><span class="n">!0</span><span class="p">}</span>
<span class="n">!0</span> <span class="p">=</span> <span class="p">!{</span><span class="k">i32</span> <span class="m">2</span><span class="p">,</span> <span class="nv">!&#34;Debug Info Version&#34;</span><span class="p">,</span> <span class="k">i32</span> <span class="m">3</span><span class="p">}</span>
</code></pre></div><p>RUN 得到结果</p>
<p>make meref-dim-run</p>
<p><code>${MLIR_OPT} ./memref-dim.mlir --lower-affine  \ -finalize-memref-to-llvm -convert-arith-to-llvm  -convert-vector-to-llvm \ -convert-func-to-llvm -reconcile-unrealized-casts | \ ${MLIR_CPU_RUNNER} ${OPT_FLAG} -e main -entry-point-result=void \ -shared-libs=${MLIR_RUNNER_UTILS} -shared-libs=${MLIR_C_RUNNER_UTILS}</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-llvm" data-lang="llvm"><span class="m">3</span>
<span class="m">2</span>
<span class="m">2</span>
<span class="m">3</span>
</code></pre></div><blockquote>
<p>总结整个流程 ：MLIR通过递降 Lowering 到 具有LLVM方言的MLIR表达，再进一步转换为LLVM IR 最后生成并在JIT执行机器代码。  这样通过多个层次的转换可以让编译器针对不同的抽象层次进行优化和调试。</p>
</blockquote>
<h2 id="dsapp-level-examples"><strong>DSApp Level Examples</strong></h2>
<h3 id="conversion-example">Conversion example</h3>
<p><strong>卷积向量化算法</strong> <code>ConvOpt/conv_2d</code></p>
<p>这里使用一个Pass <code>conv-vectorization</code> 这个Pass实现了具备strip Mining策略的系数传播算法，而且其尺寸是可控制的。</p>
<p>我们可以对linalg.conv_2d.mlir 操作进行Conversion.</p>
<p><strong><code>linalg.conv_2d</code> (linalg::Conv2DOp)</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-llvm" data-lang="llvm"><span class="err">fun</span><span class="k">c</span><span class="p">.</span><span class="err">fun</span><span class="k">c</span> <span class="vg">@conv_2d</span><span class="p">(</span><span class="nv">%arg0</span><span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;,</span> <span class="nv">%arg1</span><span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;,</span> <span class="nv">%arg2</span><span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;)</span> <span class="p">{</span>
  <span class="err">linalg</span><span class="p">.</span><span class="err">conv_</span><span class="m">2</span><span class="err">d</span> <span class="err">ins</span> <span class="p">(</span><span class="nv">%arg0</span><span class="p">,</span> <span class="nv">%arg1</span><span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;,</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;)</span>
                 <span class="err">outs</span> <span class="p">(</span><span class="nv">%arg2</span><span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;)</span>
  <span class="err">return</span>
<span class="p">}</span>
</code></pre></div><p><code>./buddy-opt ../../examples/ConvOpt/conv2d.mlir -conv-vectorization=&quot;strip-mining=256&quot;</code></p>
<p><code>affine.for</code> ：执行指定次数循环体的操作。</p>
<p><code>affine.vector_load</code>：从缓冲区切片中返回一个向量 （MLIR MemRef格式）。</p>
<p><code>affine.vector_store</code>：将一个向量写到缓存区切片中（MLIR MemRef格式）。</p>
<p><code>vector.broadcast</code>：将标量或向量值广播为 N-维 结果向量。</p>
<p><code>vector.fma</code>：向量化类型的乘加混合指令。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-llvm" data-lang="llvm"><span class="err">#map</span> <span class="p">=</span> <span class="err">affine_map</span><span class="p">&lt;(</span><span class="err">d</span><span class="m">0</span><span class="p">)</span> <span class="err">-</span><span class="p">&gt;</span> <span class="p">(</span><span class="err">d</span><span class="m">0</span><span class="p">)&gt;</span>
<span class="err">#map</span><span class="m">1</span> <span class="p">=</span> <span class="err">affine_map</span><span class="p">&lt;(</span><span class="err">d</span><span class="m">0</span><span class="p">)</span> <span class="err">-</span><span class="p">&gt;</span> <span class="p">(</span><span class="err">d</span><span class="m">0</span> <span class="err">ceildiv</span> <span class="m">256</span><span class="p">)&gt;</span>
<span class="k">module</span> <span class="p">{</span>
  <span class="err">fun</span><span class="k">c</span><span class="p">.</span><span class="err">fun</span><span class="k">c</span> <span class="vg">@conv_2d</span><span class="p">(</span><span class="nv">%arg0</span><span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;,</span> <span class="nv">%arg1</span><span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;,</span> <span class="nv">%arg2</span><span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;)</span> <span class="p">{</span>
    <span class="nv">%c0</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="k">constant</span> <span class="m">0</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span>
    <span class="nv">%c1</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="k">constant</span> <span class="m">1</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span>
    <span class="nv">%c256</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="k">constant</span> <span class="m">256</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span>
    <span class="nv">%cst</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="k">constant</span> <span class="m">0.000000e+00</span> <span class="err">:</span> <span class="err">f</span><span class="m">32</span>
    <span class="n">%0</span> <span class="p">=</span> <span class="err">vect</span><span class="k">or</span><span class="p">.</span><span class="err">splat</span> <span class="nv">%cst</span> <span class="err">:</span> <span class="err">vect</span><span class="k">or</span><span class="p">&lt;</span><span class="m">256</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
    <span class="c">;这里%arg1是变量，memref&lt;?x?xf32&gt;是其类型。这里记录arg1，arg2的4个维度
</span><span class="c"></span>    <span class="nv">%dim</span> <span class="p">=</span> <span class="err">memref</span><span class="p">.</span><span class="err">dim</span> <span class="nv">%arg1</span><span class="p">,</span> <span class="nv">%c0</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;</span>
    <span class="nv">%dim_0</span> <span class="p">=</span> <span class="err">memref</span><span class="p">.</span><span class="err">dim</span> <span class="nv">%arg1</span><span class="p">,</span> <span class="nv">%c1</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;</span>
    <span class="nv">%dim_1</span> <span class="p">=</span> <span class="err">memref</span><span class="p">.</span><span class="err">dim</span> <span class="nv">%arg2</span><span class="p">,</span> <span class="nv">%c0</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;</span>
    <span class="nv">%dim_2</span> <span class="p">=</span> <span class="err">memref</span><span class="p">.</span><span class="err">dim</span> <span class="nv">%arg2</span><span class="p">,</span> <span class="nv">%c1</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;</span>
    <span class="err">affi</span><span class="k">ne</span><span class="p">.</span><span class="err">f</span><span class="k">or</span> <span class="nv">%arg3</span> <span class="p">=</span> <span class="err">#map</span><span class="p">(</span><span class="nv">%c0</span><span class="p">)</span> <span class="k">to</span> <span class="err">#map</span><span class="p">(</span><span class="nv">%dim_1</span><span class="p">)</span> <span class="p">{</span>
      <span class="err">affi</span><span class="k">ne</span><span class="p">.</span><span class="err">f</span><span class="k">or</span> <span class="nv">%arg4</span> <span class="p">=</span> <span class="err">#map</span><span class="p">(</span><span class="nv">%c0</span><span class="p">)</span> <span class="k">to</span> <span class="err">#map</span><span class="p">(</span><span class="nv">%dim</span><span class="p">)</span> <span class="p">{</span>
        <span class="err">affi</span><span class="k">ne</span><span class="p">.</span><span class="err">f</span><span class="k">or</span> <span class="nv">%arg5</span> <span class="p">=</span> <span class="err">#map</span><span class="p">(</span><span class="nv">%c0</span><span class="p">)</span> <span class="k">to</span> <span class="err">#map</span><span class="p">(</span><span class="nv">%dim_0</span><span class="p">)</span> <span class="p">{</span>
          <span class="err">affi</span><span class="k">ne</span><span class="p">.</span><span class="err">f</span><span class="k">or</span> <span class="nv">%arg6</span> <span class="p">=</span> <span class="err">#map</span><span class="p">(</span><span class="nv">%c0</span><span class="p">)</span> <span class="k">to</span> <span class="err">#map</span><span class="m">1</span><span class="p">(</span><span class="nv">%dim_2</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">%1</span> <span class="p">=</span> <span class="err">memref</span><span class="p">.</span><span class="k">load</span> <span class="nv">%arg1</span><span class="p">[</span><span class="nv">%arg4</span><span class="p">,</span> <span class="nv">%arg5</span><span class="p">]</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;</span>
            <span class="n">%2</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="err">index_cast</span> <span class="nv">%c0</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span> <span class="k">to</span> <span class="k">i32</span>
            <span class="n">%3</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="k">sitofp</span> <span class="n">%2</span> <span class="err">:</span> <span class="k">i32</span> <span class="k">to</span> <span class="err">f</span><span class="m">32</span>
            <span class="n">%4</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="err">cmpf</span> <span class="k">one</span><span class="p">,</span> <span class="n">%1</span><span class="p">,</span> <span class="n">%3</span> <span class="err">:</span> <span class="err">f</span><span class="m">32</span>
            <span class="err">scf</span><span class="p">.</span><span class="err">if</span> <span class="n">%4</span> <span class="p">{</span>
              <span class="n">%5</span> <span class="p">=</span> <span class="err">vect</span><span class="k">or</span><span class="p">.</span><span class="err">broadcast</span> <span class="n">%1</span> <span class="err">:</span> <span class="err">f</span><span class="m">32</span> <span class="k">to</span> <span class="err">vect</span><span class="k">or</span><span class="p">&lt;</span><span class="m">256</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
              <span class="n">%6</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="err">muli</span> <span class="nv">%arg6</span><span class="p">,</span> <span class="nv">%c256</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span>
              <span class="n">%7</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="err">subi</span> <span class="nv">%dim_2</span><span class="p">,</span> <span class="n">%6</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span>
              <span class="n">%8</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="err">cmpi</span> <span class="k">sge</span><span class="p">,</span> <span class="n">%7</span><span class="p">,</span> <span class="nv">%c256</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span>
              <span class="err">scf</span><span class="p">.</span><span class="err">if</span> <span class="n">%8</span> <span class="p">{</span>
                <span class="n">%9</span> <span class="p">=</span> <span class="err">affi</span><span class="k">ne</span><span class="p">.</span><span class="err">vector_</span><span class="k">load</span> <span class="nv">%arg0</span><span class="p">[</span><span class="nv">%arg3</span> <span class="err">+</span> <span class="nv">%arg4</span><span class="p">,</span> <span class="nv">%arg5</span> <span class="err">+</span> <span class="nv">%arg6</span> <span class="p">*</span> <span class="m">256</span><span class="p">]</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;,</span> <span class="err">vect</span><span class="k">or</span><span class="p">&lt;</span><span class="m">256</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
                <span class="n">%10</span> <span class="p">=</span> <span class="err">affi</span><span class="k">ne</span><span class="p">.</span><span class="err">vector_</span><span class="k">load</span> <span class="nv">%arg2</span><span class="p">[</span><span class="nv">%arg3</span><span class="p">,</span> <span class="nv">%arg6</span> <span class="p">*</span> <span class="m">256</span><span class="p">]</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;,</span> <span class="err">vect</span><span class="k">or</span><span class="p">&lt;</span><span class="m">256</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
                <span class="n">%11</span> <span class="p">=</span> <span class="err">vect</span><span class="k">or</span><span class="p">.</span><span class="err">fma</span> <span class="n">%9</span><span class="p">,</span> <span class="n">%5</span><span class="p">,</span> <span class="n">%10</span> <span class="err">:</span> <span class="err">vect</span><span class="k">or</span><span class="p">&lt;</span><span class="m">256</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
                <span class="err">affi</span><span class="k">ne</span><span class="p">.</span><span class="err">vector_</span><span class="k">store</span> <span class="n">%11</span><span class="p">,</span> <span class="nv">%arg2</span><span class="p">[</span><span class="nv">%arg3</span><span class="p">,</span> <span class="nv">%arg6</span> <span class="p">*</span> <span class="m">256</span><span class="p">]</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;,</span> <span class="err">vect</span><span class="k">or</span><span class="p">&lt;</span><span class="m">256</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
              <span class="p">}</span> <span class="err">else</span> <span class="p">{</span>
                <span class="n">%9</span> <span class="p">=</span> <span class="err">vect</span><span class="k">or</span><span class="p">.</span><span class="err">create_mask</span> <span class="n">%7</span> <span class="err">:</span> <span class="err">vect</span><span class="k">or</span><span class="p">&lt;</span><span class="m">256</span><span class="err">x</span><span class="k">i1</span><span class="p">&gt;</span>
                <span class="n">%10</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="err">addi</span> <span class="nv">%arg3</span><span class="p">,</span> <span class="nv">%arg4</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span>
                <span class="n">%11</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="err">muli</span> <span class="nv">%arg6</span><span class="p">,</span> <span class="nv">%c256</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span>
                <span class="n">%12</span> <span class="p">=</span> <span class="err">arith</span><span class="p">.</span><span class="err">addi</span> <span class="nv">%arg5</span><span class="p">,</span> <span class="n">%11</span> <span class="err">:</span> <span class="err">inde</span><span class="k">x</span>
                <span class="n">%13</span> <span class="p">=</span> <span class="err">vect</span><span class="k">or</span><span class="p">.</span><span class="err">masked</span><span class="k">load</span> <span class="nv">%arg0</span><span class="p">[</span><span class="n">%10</span><span class="p">,</span> <span class="n">%12</span><span class="p">],</span> <span class="n">%9</span><span class="p">,</span> <span class="n">%0</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;,</span> <span class="err">vect</span><span class="k">or</span><span class="p">&lt;</span><span class="m">256</span><span class="err">x</span><span class="k">i1</span><span class="p">&gt;,</span> <span class="err">vect</span><span class="k">or</span><span class="p">&lt;</span><span class="m">256</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span> <span class="err">in</span><span class="k">to</span> <span class="err">vect</span><span class="k">or</span><span class="p">&lt;</span><span class="m">256</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
                <span class="n">%14</span> <span class="p">=</span> <span class="err">vect</span><span class="k">or</span><span class="p">.</span><span class="err">masked</span><span class="k">load</span> <span class="nv">%arg2</span><span class="p">[</span><span class="nv">%arg3</span><span class="p">,</span> <span class="n">%11</span><span class="p">],</span> <span class="n">%9</span><span class="p">,</span> <span class="n">%0</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;,</span> <span class="err">vect</span><span class="k">or</span><span class="p">&lt;</span><span class="m">256</span><span class="err">x</span><span class="k">i1</span><span class="p">&gt;,</span> <span class="err">vect</span><span class="k">or</span><span class="p">&lt;</span><span class="m">256</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span> <span class="err">in</span><span class="k">to</span> <span class="err">vect</span><span class="k">or</span><span class="p">&lt;</span><span class="m">256</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
                <span class="n">%15</span> <span class="p">=</span> <span class="err">vect</span><span class="k">or</span><span class="p">.</span><span class="err">fma</span> <span class="n">%13</span><span class="p">,</span> <span class="n">%5</span><span class="p">,</span> <span class="n">%14</span> <span class="err">:</span> <span class="err">vect</span><span class="k">or</span><span class="p">&lt;</span><span class="m">256</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
                <span class="err">vect</span><span class="k">or</span><span class="p">.</span><span class="err">masked</span><span class="k">store</span> <span class="nv">%arg2</span><span class="p">[</span><span class="nv">%arg3</span><span class="p">,</span> <span class="n">%11</span><span class="p">],</span> <span class="n">%9</span><span class="p">,</span> <span class="n">%15</span> <span class="err">:</span> <span class="err">memref</span><span class="p">&lt;</span><span class="err">?</span><span class="k">x</span><span class="err">?xf</span><span class="m">32</span><span class="p">&gt;,</span> <span class="err">vect</span><span class="k">or</span><span class="p">&lt;</span><span class="m">256</span><span class="err">x</span><span class="k">i1</span><span class="p">&gt;,</span> <span class="err">vect</span><span class="k">or</span><span class="p">&lt;</span><span class="m">256</span><span class="err">xf</span><span class="m">32</span><span class="p">&gt;</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="err">return</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="edge-detection-example">Edge detection example</h3>
<!-- raw HTML omitted -->
<p>这里记录一个难点。在安装好opencv环境后，如果直接运行 <code>AutoConfig</code> 会产生报错：提示 can not find OpenCVConfig.cmake .</p>
<p><code>解决方法</code> 需要在/path/to/opencv下使用 <code>find ./  -name &quot;OpenCVConfig.cmake&quot;</code> 并将该文件所在路径放到环境变量OpenCV_XXX_DIR中 此变量名在makefile中查找即可。</p>
<!-- raw HTML omitted -->
<p>具体ninjia的执行方式可以在build.ninja中查明。但是目前不熟悉ninjia的构成方式，暂时不作分析。</p>
<p>这里可以开启副本，关注buddy-opt的benchmark</p>
<h3 id="digital-image-processing-examples"><strong>Digital Image Processing Examples</strong></h3>
<p><strong>Conversion example:</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"> <span class="nb">cd</span> buddy-mlir/build/bin
./buddy-opt ../../frontend/Interfaces/DIP.mlir --lower-dip<span class="o">=</span><span class="s2">&#34;DIP-strip-mining=</span><span class="si">${</span><span class="nv">BUDDY_DIP_OPT_STRIP_MINING</span><span class="si">}</span><span class="s2">&#34;</span>
</code></pre></div><p>这里DIP.mlir在前端的接口中 这里DIP.mlir是一个相当大的文件，用于处理图像数据，在进行conversion后可以观察到Dialect由dip → vector和arith等MLIR内部的Dialect 完成了一次Conversion</p>
<p>其余步骤和之前的Edge detection相似，不再赘述。</p>
<p>经过实际测试，目前Rotation example, Resize example， Morphological Operations example均无法运行。<strong>Digital Audio Processing Examples视频处理也无法运行。</strong></p>
<p>原因是可以正常cmake,但是无法进行ninja的构建，换句话说，build.ninja中没有相关target.</p>
<h2 id="testing-and-demonstrating-examples"><strong>Testing and Demonstrating Examples</strong></h2>
<p>此部分在之前的章节已经进行测试。</p>
<ul class="pa0">
  
   <li class="list di">
     <a href="/tags/mlir/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">MLIR</a>
   </li>
  
   <li class="list di">
     <a href="/tags/ai-compiler/" class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">AI Compiler</a>
   </li>
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l"><div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Table of contents</p>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#examples-解读">Examples 解读</a>
      <ul>
        <li><a href="#buddialect"><code>BudDialect</code></a></li>
        <li><a href="#ir级别的解读">IR级别的解读</a></li>
        <li><a href="#mlirmemref"><code>MLIRMemRef</code></a></li>
      </ul>
    </li>
    <li><a href="#dsapp-level-examples"><strong>DSApp Level Examples</strong></a>
      <ul>
        <li><a href="#conversion-example">Conversion example</a></li>
        <li><a href="#edge-detection-example">Edge detection example</a></li>
        <li><a href="#digital-image-processing-examples"><strong>Digital Image Processing Examples</strong></a></li>
      </ul>
    </li>
    <li><a href="#testing-and-demonstrating-examples"><strong>Testing and Demonstrating Examples</strong></a></li>
  </ul>
</nav>
  </div>




  <div class="bg-light-gray pa3 nested-list-reset nested-copy-line-height nested-links">
    <p class="f5 b mb3">Related</p>
    <ul class="pa0 list">
	   
	     <li  class="mb2">
          <a href="/2024/09/06/buddy_src_0/">Buddy Compiler 源码解读(0)</a>
        </li>
	    
    </ul>
</div>

</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://zhighway777.github.io/" >
    &copy;  Zeng::blog 2025 
  </a>
    <div>
<div class="ananke-socials">
  
    
    <a href="https://github.com/Zhighway777" target="_blank" rel="noopener" class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" aria-label="follow on GitHub——Opens in a new window">
      
        <span class="icon"><svg style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>
</span>
      
<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000"  xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;"/>
</svg>
</span></a>
  
</div>
</div>
  </div>
</footer>

  </body>
</html>
